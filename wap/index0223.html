<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>首页</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=7e62760db2e3b0b1d9bde5bf408b7662"></script>
		<script type="text/javascript" src="http://webapi.amap.com/demos/js/liteToolbar.js"></script>
		<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=C93b5178d7a8ebdb830b9b557abce78b"></script>
		<link rel="stylesheet" type="text/css" href="css/reset.css" />
		<link rel="stylesheet" type="text/css" href="css/index.css" />
		<link rel="stylesheet" type="text/css" href="css/swiper-3.3.1.min.css" />
		<link rel="stylesheet" type="text/css" href="css/footer.css" />
	</head>

	<body>
		<!--首页搜索栏-->
		<div class="home-seach">
			<img class="home-scan" src="images/z-14.png" />
			<div class="home-total">
				<img class="home-search" src="images/z-16.png" />
				<input class="home-input" type="" name="" id="" placeholder="搜索商品" />
			</div>
			<div class="gou-count">
				<img src="images/z-190.png" />
				<span class="z-goucount"></span>
			</div>
			<img class="home-info" src="images/z-15.png" />
		</div>
		<!--轮播图-->
		<div class="swiper-container">
			<div class="swiper-wrapper">
			</div>
			<!--分页器-->
			<div class="swiper-pagination"></div>
			<div class="swiper-pagination"></div>
			<div class="swiper-pagination"></div>
		</div>
		<!--超值推荐模块-->
		<div class="home-rec">
			<div class="home-rec1">
				<span class="over">新品</span><span class="rec">推荐</span>
			</div>
			<div class="home-rec2">
				<span class="more">更多</span>
				<img class="more-img" src="images/z-18.png" />
			</div>
		</div>
		<!--物品模块-->
		<div class="home-middle all">
			<ul class="home-goods inner zishu">
				<li id="aaa">
				</li>
			</ul>
		</div>
		<div class="home-shopping"></div>
		<!--超值推荐模块二-->
		<div class="home-rec">
			<div class="home-rec1">
				<span class="over">超值</span><span class="rec">推荐</span>
			</div>
			<div class="home-rec2 home-rec3">
				<span class="more">更多</span>
				<img class="more-img" src="images/z-18.png" />
			</div>
		</div>
		<!--物品模块-->
		<div class="home-middle all z-index home-chaozhi">
			<ul class="chazhi zishu" id="inner">
				<li>
				</li>
			</ul>
		</div>
		<div class="home-shopping1"></div>
		<div id="container"></div>
		<!--<div class="z-prompt" style="display: none;">浏览器不支持地理定位。</div>
		<div class="z-prompt1" style="display: none;">定位失败,用户拒绝请求地理定位。</div>
		<div class="z-prompt2" style="display: none;">定位失败,位置信息是不可用。</div>
		<div class="z-prompt3" style="display: none;">定位失败,请求获取用户位置超时。</div>
		<div class="z-prompt4" style="display: none;">定位失败,定位系统失效。</div>-->
		<div class="z-prompt5" style="display: none;"></div>
		<div class="z-prompt6" style="display: none;"></div>
		<!--底部开始-->
		<div class="footer">
			<a href="index.html"><img src="images/souye2.png" alt=""></a>
			<a href="fenlei.html"><img src="images/kinds.png" alt=""></a>
			<a href="coalition.html"><img src="images/union.png" alt=""></a>
			<a href="jfmember.html" class="lcf"><img src="images/wealth.png" alt=""></a>
			<a href="z-member.html" class="w_my"><img src="images/me.png" alt=""></a>
		</div>
	</body>
	<script type="text/javascript" src="js/jquery-2.2.3.min.js"></script>
	<script type="text/javascript" src="js/box.js"></script>
	<script type="text/javascript" src="js/url.js"></script>
	<script type="text/javascript" src="js/flipsnap.js"></script>
	<script type="text/javascript" src="js/swiper-3.3.1.min.js"></script>
	<script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
	<script src="js/wx_qrCode.js"></script>
	<script type="text/javascript">
		$(function() {
			wxInity('/wap/index.html');
			/*
	//微信扫一扫开始
	wx.config({
    debug: false,
    appId: 'wx10a59d3bf7f7f692',
    timestamp: '1478075518',
    nonceStr: 'DaP43TjEgiV6rqA5',
    signature: '2a84cf207291cdc8a5f81ed5d8a00e5de9ad7937',
    jsApiList: [
        'checkJsApi',
        'scanQRCode',
    ]
 });
  wx.ready(function () {
    // 在这里调用 API
  });
  */
			var tokens = localStorage.getItem("token");
			var types = localStorage.getItem("type");
			$(".home-scan").click(function() {
				if(tokens == null) {
					$(".z-prompt5").html("请先登录").show();
					setTimeout(function() {
						$(".z-prompt5").hide();
					}, 1000);
					setTimeout(function() {
						window.location.href = "denglu.html"
					}, 1500);

				} else {
					saoyisao();
				}

				/*
 	wx.scanQRCode({
    needResult: 0, // 默认为0，扫描结果由微信处理，1则直接返回扫描结果，
    scanType: ["qrCode","barCode"], // 可以指定扫二维码还是一维码，默认二者都有
    success: function (res) {
    var result = res.resultStr; // 当needResult 为 1 时，扫码返回的结果
    }
    });
    */
			});
			//微信扫一扫结束
			//设置字体限制
			//			var tokens = localStorage.getItem("token");
			//			var types = localStorage.getItem("type");
			if(types == 1) {
				$(".w_my").attr("href", "z-member.html");
			} else if(types == 2) {
				$(".w_my").attr("href", "z-unicon.html");
			} else if(types == 3) {
				$(".w_my").attr("href", "z-sell.html");
			} else if(types == 4) {
				$(".w_my").attr("href", "z-comm.html");
			} else if(types == 5) {
				$(".w_my").attr("href", "z-county.html");
			} else if(types == 6) {
				$(".w_my").attr("href", "z-city.html");
			} else if(types == 7) {
				$(".w_my").attr("href", "z-provin.html");
			}
			if(types == 1) {
				$(".lcf").attr("href", "jfmember.html");
			} else {
				$(".lcf").attr("href", "jffortune.html");
			}
			var liWidth = $("#aaa").width();
			console.log(liWidth)
			var flipsnap = Flipsnap('.inner', {
				distance: liWidth,
				maxPoint: 4
			});
			var flipsnap = Flipsnap('#inner', {
				distance: liWidth,
				maxPoint: 7
			});
			$(".home-total").click(function() {
				location.href = "history-seach.html";
			});
			$(".home-info").click(function() {
				location.href = "newscentre.html";
			});
			$(".home-rec2").each(function() {
				$(this).click(function() {
					location.href = "z-home-xrecom.html";
				});
			});
			$(".home-rec3").each(function() {
				$(this).click(function() {
					location.href = "z-home-recom.html";
				});
			});
			$(".home-shopping").click(function() {
				location.href = "gou.html";
			});
			//       联盟商家跳转
			//			$(".z_business").click(function() {
			//				location.href = "fortune.html";
			//			});
			//首页购物车数量计算
			var lengs = 0;
			//购物车数量ajax
			$.ajax({
				type: 'POST',
				url: Url + "api/index.php?n=goods&f=goods_car",
				dataType: "json",
				data: {
					token: tokens
				},
				success: function(data) {
					if(data.msg == "购物车内没有商品") {
						$(".gou-count").click(function() {
							window.location.href = "shopping-cart.html";
							$(".z-goucount").hide();
						});
					}
					if(data.msg == "请先登录") {
						$(".gou-count").click(function() {
							window.location.href = "denglu.html";
							$(".z-goucount").hide();
						});
					}
					if(data.msg == "身份错误，请重新登录") {
						$(".gou-count").click(function() {
							window.location.href = "denglu.html";
							$(".z-goucount").hide();
						});
					}
					if(data.msg == "购物车信息") {
						$(".z-goucount").show();
						var datas = data.data;
						for(var i = 0; i < datas.length; i++) {
							for(var j = 0; j < datas[i].goods.length; j++) {}
							lengs += datas[i].goods.length;
							if(lengs == 0) {
								$(".z-goucount").hide();
							} else {
								$(".z-goucount").html(lengs);
							}
							$(".z-goucount").click(function() {
								window.location.href = "gou.html";
							})
						}
					}
				},
				error: function(data) {},
			});
			//点击二维码扫一扫接口结束         
			//推薦商品ajax
			//定义一个存放商品id的数组
			//新品推荐接口
			var zleng;
			var goodArr = [];
			$.ajax({
				type: 'POST',
				url: Url + "api/index.php?n=wendy&f=newgoods",
				dataType: "json",
				data: {
					"page": 1
				},
				success: function(data) {
					var datas = data.data;
					for(var i = 0; i < datas.length; i++) {
						var html = '<li><span>' + datas[i].goods_name + '</span><img src="' + Url + '' + datas[i].default_image + '"/><p>￥' + datas[i].price + '</p></li>';
						$(".home-goods").append(html);
						goodArr.push(datas[i].goods_id)
					}
					$('.home-goods li img').error(function() {
						$(this).attr('src', 'images/z-logo.png');
					});
					zleng = ($(".home-goods li").length) * 21.0;
					console.log(zleng);
					$(".home-goods").css("width", zleng + "rem");
					//页面跳转
					$(".home-goods li").each(function() {
						$(this).click(function() {
							var a = $(this).index();
							localStorage.setItem('good', goodArr[a - 1]);
							location.href = "goods-order.html?goodsid=" + goodArr[a - 1];
						})
					});
					word(6);
				},
				error: function(data) {}
			});
			//超值推荐接口开始
			var zlen;
			var goodArr1 = []
			$.ajax({
				type: 'POST',
				url: Url + "api/index.php?n=goods&f=mrecgoods",
				dataType: "json",
				data: {
					"page": 1               
				},
				success: function(data) {
					var datas = data.data;
					for(var i = 0; i < datas.length; i++) {
						var html = '<li><span>' + datas[i].goods_name + '</span><img src="' + Url + '' + datas[i].default_image + '"/><p>￥' + datas[i].price + '</p></li>';
						$(".chazhi").append(html);
						goodArr1.push(datas[i].goods_id)
					}
					$('.chazhi li img').error(function() {
						$(this).attr('src', 'images/z-logo.png');
					});
					zlen = ($(".chazhi li").length) * 21.0;
					console.log(zlen)
					$(".chazhi").css("width", zlen + "rem");
					//页面跳转
					$(".chazhi li").each(function() {
						$(this).click(function() {
							var a = $(this).index();
							localStorage.setItem('good', goodArr1[a - 1]);
							location.href = "goods-order.html?goodsid=" + goodArr1[a - 1];
						});
					});
					word(6)
				},
				error: function(data) {}
			});
			//超值推荐接口结束
			var LinkUrl = [];
			//首页轮播图开始
			$.ajax({
				//contentType:"application/x-www-form-urlencoded; charset=gb2312",
				type: 'POST',
				url: Url + "api/index.php?n=wendy&f=cate_ad",
				dataType: "json",
				data: {},
				success: function(data) {
					var datas = data.data;
					for(var i = 0; i < datas.length; i++) {
						html = '';
						var html = '<li class="swiper-slide"><img src="' + Url + '' + datas[i].ad_logo + '"></li>';
						$(".swiper-wrapper").append(html);
						LinkUrl.push(datas[i].ad_link);
					}
					//					console.log(LinkUrl);
					$(".swiper-slide").click(function() {
						var ad = $(this).index();
						window.location.href = Url + LinkUrl[ad - 1];
					});
					$('.swiper-slide img').error(function() {
						$(this).attr('src', 'images/z-logo.png');
					});
					var mySwiper = new Swiper('.swiper-container', {
						direction: 'horizontal',
						autoplay: 3000,
						loop: true,
						pagination: '.swiper-pagination',
						paginationClickable: true,
					});
				},
				error: function(data) {}
			});
			//首页轮播图结束
			var lnglatXY = [];
			//百度api定位开始
			var map = new BMap.Map();
			var point = new BMap.Point();
			var geolocation = new BMap.Geolocation();
			geolocation.getCurrentPosition(function(r) {
					if(this.getStatus() == BMAP_STATUS_SUCCESS) {
						localStorage.setItem('lgt', r.point.lng);
						localStorage.setItem('lat', r.point.lat);
						localStorage.setItem('zlgt', r.point.lng);
						localStorage.setItem('zlat', r.point.lat);
						lnglatXY = [r.point.lng, r.point.lat];
						zhuanhuan();
					} else {
						//alert('failed' + this.getStatus());
					}
				}, {
					enableHighAccuracy: true
				})
				//百度api定位结束				
			var map = new AMap.Map('container', {}); //地图上所标点的坐标
			function zhuanhuan() {
				AMap.plugin('AMap.Geocoder', function() {
					var geocoder = new AMap.Geocoder({
						city: "010" //城市，默认：“全国”
					});
					var marker = new AMap.Marker({
						map: map,
						bubble: true
					})
					geocoder.getAddress(lnglatXY, function(status, result) {
						if(status === 'complete' && result.info === 'OK') {
							//							console.log(result.regeocode.formattedAddress.length);
							var address = result.regeocode.formattedAddress;
							//							console.log(address)
							var zaddrea = address.substr(3, 6);
							localStorage.setItem('zadd', zaddrea);
							localStorage.setItem('zzaadd1', zaddrea);
						} else {}
					})

				});
			}
			//百度api定位结束
			//限制字数方法
			function word(len) {
				$(".zishu li span").each(function() {
					var counter = $(this).text().length; //获取文本域的字符串长度
					var txt = $(this).text();
					if(counter >= len) {
						var num = $(this).text().substr(0, len);
						$(this).text(num + '....');
					} else {
						$(this).text(txt);
					}
				});
			}
			//图片设置默认失败方法
		});
	</script>

</html>